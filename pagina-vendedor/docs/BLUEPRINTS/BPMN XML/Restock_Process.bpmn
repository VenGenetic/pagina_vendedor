<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:bioc="http://bpmn.io/schema/bpmn/biocolor/1.0" id="Definitions_Restock" targetNamespace="http://menards.com/bpmn/restock" exporter="Camunda Modeler" exporterVersion="5.43.1">
  <bpmn:collaboration id="Collaboration_Restock">
    <bpmn:participant id="Participant_Restock" name="Restock Process (Review-First + Discount Earnings)" processRef="Process_Restock" />
  </bpmn:collaboration>
  <bpmn:process id="Process_Restock" name="Inventory Restock with Review-First Approval" isExecutable="true">
    <bpmn:laneSet id="LaneSet_Restock">
      <bpmn:lane id="Lane_Admin" name="Admin (Frontend) / Administrador (Frontend)">
        <bpmn:flowNodeRef>StartEvent_Restock</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Activity_EnterRestock</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Activity_ReviewProposals</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Gateway_ApproveReject</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>EndEvent_RestockRejected</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>EndEvent_RestockComplete</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="Lane_System" name="System (External Workers) / Sistema">
        <bpmn:flowNodeRef>Activity_QueryDemandStudy</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>EndEvent_RestockRejected</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Activity_RecordFinancial</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>EndEvent_RestockAborted</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Activity_UpdateStock</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Activity_VerifyConsistency</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Gateway_NegativeStock</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>BoundaryEvent_FinancialFail</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Activity_ResetNegativeStock</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Activity_CalculateWAC</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Activity_ApplyPrices</bpmn:flowNodeRef>
      </bpmn:lane>
    </bpmn:laneSet>
    <bpmn:startEvent id="StartEvent_Restock" name="Restock Needed / Necesita Reabastecimiento">
      <bpmn:outgoing>Flow_R1</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:userTask id="Activity_EnterRestock" name="Enter Items &#38; Provider Details / Ingresar Ítems y Detalles">
      <bpmn:documentation>ENTRY FORM with auto-populated defaults:
- Tax: 15% (IVA)
- Margin Target: 65% (Automatic)
- Discount: 0% (Standard)
- Negotiated Cost: Optional override. If set, this is the REAL price paid.
- Price Drop Alert: triggers if new cost &lt; previous cost</bpmn:documentation>
      <bpmn:extensionElements>
        <camunda:formData>
          <camunda:formField id="listPrice" label="List Price" type="long" />
          <camunda:formField id="taxPercent" label="Tax %" type="long" defaultValue="15" />
          <camunda:formField id="discountPercent" label="Discount % (Optional)" type="long" defaultValue="0" />
          <camunda:formField id="negotiatedCost" label="Negotiated Cost (Override)" type="long" />
          <camunda:formField id="priceDropDetected" label="Price Drop Alert" type="boolean" defaultValue="false" />
        </camunda:formData>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_R1</bpmn:incoming>
      <bpmn:outgoing>Flow_R_Demand</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:serviceTask id="Activity_QueryDemandStudy" name="Query Demand Study &#38; Validate Products / Consultar Demanda y Validar" camunda:type="external" camunda:topic="demand-aggregator-query">
      <bpmn:documentation>DEMAND + COST + CONFLICT DETECTION:
1. Queries demand_hits for suggested quantities
2. Fetches historical cost data for price drop detection
3. UPSERT CHECK: Compares entered product attributes vs database
   - If Code exists but Name differs → nameChangeDetected = true
   - Returns oldName (system) vs newName (provider) for review
4. No duplicates created - Code is the anchor</bpmn:documentation>
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="productIds">${selectedProductIds}</camunda:inputParameter>
          <camunda:inputParameter name="productNames">${enteredProductNames}</camunda:inputParameter>
          <camunda:inputParameter name="lookbackDays">30</camunda:inputParameter>
          <camunda:outputParameter name="demandSuggestions">${demandSuggestions}</camunda:outputParameter>
          <camunda:outputParameter name="previousCost">${previousCost}</camunda:outputParameter>
          <camunda:outputParameter name="nameChangeDetected">${nameChangeDetected}</camunda:outputParameter>
          <camunda:outputParameter name="oldName">${systemProductName}</camunda:outputParameter>
          <camunda:outputParameter name="newName">${providerProductName}</camunda:outputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_R_Demand</bpmn:incoming>
      <bpmn:outgoing>Flow_ToReview</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:userTask id="Activity_ReviewProposals" name="Review Margins &#38; Approve Purchase / Revisar Márgenes y Aprobar">
      <bpmn:documentation>REVIEW BEFORE PAYMENT:
User reviews and approves:
- Suggested Quantity
- Margin Setting: 65% Markup on List Price
- CALCULATED EARNING: Unitaty cost- Negotiated Cost (The Gap)if negociated price is sent as empty, the system takes it as 0 
- Net Amount to pay = Negotiated Cost (if set) OR List Price - Discount
- NAME MISMATCH check

APPROVAL GATE: No payment occurs until user approves!</bpmn:documentation>
      <bpmn:extensionElements>
        <camunda:formData>
          <camunda:formField id="listPrice" label="List Price" type="long" />
          <camunda:formField id="negotiatedCost" label="Negotiated Cost" type="long" />
          <camunda:formField id="systemEarning" label="System Earning (Gap)" type="long" />
          <camunda:formField id="nameChangeDetected" label="Name Mismatch Detected?" type="boolean" defaultValue="false" />
          <camunda:formField id="oldName" label="System Name" type="string" />
          <camunda:formField id="newName" label="Provider Name" type="string" />
          <camunda:formField id="updateProductDetails" label="Update System with New Details?" type="boolean" defaultValue="true" />
        </camunda:formData>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_ToReview</bpmn:incoming>
      <bpmn:outgoing>Flow_R6</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:exclusiveGateway id="Gateway_ApproveReject" name="Approve? / ¿Aprobar?">
      <bpmn:incoming>Flow_R6</bpmn:incoming>
      <bpmn:outgoing>Flow_Approved</bpmn:outgoing>
      <bpmn:outgoing>Flow_Rejected</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:endEvent id="EndEvent_RestockRejected" name="Restock Cancelled / Cancelado">
      <bpmn:documentation>User rejected the purchase. No payment made, no inventory changed.</bpmn:documentation>
      <bpmn:incoming>Flow_Rejected</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:serviceTask id="Activity_RecordFinancial" name="Record Financial Transaction (PURCHASE) / Registrar Transacción (COMPRA)" camunda:asyncBefore="true" camunda:type="external" camunda:topic="finance-record-purchase">
      <bpmn:documentation>ATOMIC LINKAGE + DISCOUNT EARNING:
1. Debits Bank Account for NET AMOUNT:
   - If Negotiated Cost exists: Debit = Negotiated Cost
   - Else: Debit = List Price - (List Price * Discount%)
2. Credits 'Savings/Earnings' ledger for The Gap:
   - If Negotiated Cost exists: Credit = List Price - Negotiated Cost
   - Else: Credit = List Price * Discount%

Example: List $100, Negotiated to $85
- Inventory Value: $100
- Bank Debit: $85
- Earnings Credit: $15</bpmn:documentation>
      <bpmn:extensionElements>
        <camunda:failedJobRetryTimeCycle>R3/PT1M</camunda:failedJobRetryTimeCycle>
        <camunda:inputOutput>
          <camunda:inputParameter name="amountToDebit">${negotiatedCost != null ? negotiatedCost : (listPrice - (listPrice * (discountPercent/100)))}</camunda:inputParameter>
          <camunda:inputParameter name="reportedEarnings">${negotiatedCost != null ? (listPrice - negotiatedCost) : (listPrice * (discountPercent/100))}</camunda:inputParameter>
          <camunda:inputParameter name="includeLandedCosts">true</camunda:inputParameter>
          <camunda:outputParameter name="transactionGroupId">${transactionGroupId}</camunda:outputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_Approved</bpmn:incoming>
      <bpmn:outgoing>Flow_FinancialOK</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:boundaryEvent id="BoundaryEvent_FinancialFail" name="Financial Failed / Fallo Financiero" attachedToRef="Activity_RecordFinancial">
      <bpmn:outgoing>Flow_Abort</bpmn:outgoing>
      <bpmn:errorEventDefinition id="ErrorDef_FinancialFail" errorRef="Error_FinancialFailed" />
    </bpmn:boundaryEvent>
    <bpmn:endEvent id="EndEvent_RestockAborted" name="Restock Aborted (Payment Failed) / Abortado">
      <bpmn:documentation>Financial transaction failed. Inventory was NEVER modified. Safe state.</bpmn:documentation>
      <bpmn:incoming>Flow_Abort</bpmn:incoming>
      <bpmn:errorEventDefinition id="ErrorDef_Aborted" errorRef="Error_FinancialFailed" />
    </bpmn:endEvent>
    <bpmn:serviceTask id="Activity_UpdateStock" name="Create Inventory Movement (IN) / Crear Movimiento (ENTRADA)" camunda:asyncBefore="true" camunda:type="external" camunda:topic="inventory-create-movement">
      <bpmn:documentation>Creates inventory_movements record with movement_type=IN.
Links to transaction_group_id for audit correlation.</bpmn:documentation>
      <bpmn:extensionElements>
        <camunda:failedJobRetryTimeCycle>R3/PT1M</camunda:failedJobRetryTimeCycle>
        <camunda:inputOutput>
          <camunda:inputParameter name="transactionGroupId">${transactionGroupId}</camunda:inputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_FinancialOK</bpmn:incoming>
      <bpmn:outgoing>Flow_StockUpdated</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:serviceTask id="Activity_VerifyConsistency" name="Verify Stock Consistency / Verificar Consistencia" camunda:type="external" camunda:topic="inventory-verify-consistency">
      <bpmn:documentation>VERIFICATION: Confirms SUM(inventory_movements) matches products.current_stock.</bpmn:documentation>
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:outputParameter name="currentStock">${verifiedCurrentStock}</camunda:outputParameter>
          <camunda:outputParameter name="isConsistent">${isConsistent}</camunda:outputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_StockUpdated</bpmn:incoming>
      <bpmn:outgoing>Flow_R_Check</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:exclusiveGateway id="Gateway_NegativeStock" name="Current Stock &#60; 0? / ¿Stock &#60; 0?">
      <bpmn:incoming>Flow_R_Check</bpmn:incoming>
      <bpmn:outgoing>Flow_NegYes</bpmn:outgoing>
      <bpmn:outgoing>Flow_NegNo</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_R1" sourceRef="StartEvent_Restock" targetRef="Activity_EnterRestock" />
    <bpmn:sequenceFlow id="Flow_R_Demand" sourceRef="Activity_EnterRestock" targetRef="Activity_QueryDemandStudy" />
    <bpmn:sequenceFlow id="Flow_ToReview" sourceRef="Activity_QueryDemandStudy" targetRef="Activity_ReviewProposals" />
    <bpmn:sequenceFlow id="Flow_R6" sourceRef="Activity_ReviewProposals" targetRef="Gateway_ApproveReject" />
    <bpmn:sequenceFlow id="Flow_Approved" name="Approved" sourceRef="Gateway_ApproveReject" targetRef="Activity_RecordFinancial">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${approved == true}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_Rejected" name="Rejected" sourceRef="Gateway_ApproveReject" targetRef="EndEvent_RestockRejected">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${approved == false}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_Abort" sourceRef="BoundaryEvent_FinancialFail" targetRef="EndEvent_RestockAborted" />
    <bpmn:sequenceFlow id="Flow_FinancialOK" sourceRef="Activity_RecordFinancial" targetRef="Activity_UpdateStock" />
    <bpmn:sequenceFlow id="Flow_StockUpdated" sourceRef="Activity_UpdateStock" targetRef="Activity_VerifyConsistency" />
    <bpmn:sequenceFlow id="Flow_R_Check" sourceRef="Activity_VerifyConsistency" targetRef="Gateway_NegativeStock" />
    <bpmn:sequenceFlow id="Flow_NegYes" name="Negative" sourceRef="Gateway_NegativeStock" targetRef="Activity_ResetNegativeStock">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${currentStock &lt; 0}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_NegNo" name="Positive" sourceRef="Gateway_NegativeStock" targetRef="Activity_CalculateWAC">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${currentStock &gt;= 0}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_AfterReset" sourceRef="Activity_ResetNegativeStock" targetRef="Activity_CalculateWAC" />
    <bpmn:sequenceFlow id="Flow_R4" sourceRef="Activity_CalculateWAC" targetRef="Activity_ApplyPrices" />
    <bpmn:sequenceFlow id="Flow_PricesApplied" sourceRef="Activity_ApplyPrices" targetRef="EndEvent_RestockComplete" />
    <bpmn:serviceTask id="Activity_ResetNegativeStock" name="Reset Negative Stock to Zero / Resetear Negativo" camunda:asyncBefore="true" camunda:type="external" camunda:topic="inventory-negative-reset">
      <bpmn:documentation>The Forgiveness Law: If current_stock &lt; 0, reset and use incoming cost as new WAC.</bpmn:documentation>
      <bpmn:extensionElements>
        <camunda:failedJobRetryTimeCycle>R3/PT1M</camunda:failedJobRetryTimeCycle>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_NegYes</bpmn:incoming>
      <bpmn:outgoing>Flow_AfterReset</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:serviceTask id="Activity_CalculateWAC" name="Calculate WAC (with Landed Costs) / Calcular CPP (con Costos)" camunda:asyncBefore="true" camunda:type="external" camunda:topic="inventory-calculate-wac">
      <bpmn:documentation>Formula: ((Old_Stock * Old_Cost) + (New_Stock * New_Cost) + Landed_Costs) / Total_Stock

INVENTORY COST = List Price (full value for margin calculation)
NET PAYMENT = List Price - Discount (actual cash out)

PRICE PROPOSAL:
- Generates a PENDING entry in 'price_proposals' table.
- Does NOT update products.cost_price automatically.
- Requires Admin approval to commit price changes.</bpmn:documentation>
      <bpmn:extensionElements>
        <camunda:failedJobRetryTimeCycle>R3/PT1M</camunda:failedJobRetryTimeCycle>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_NegNo</bpmn:incoming>
      <bpmn:incoming>Flow_AfterReset</bpmn:incoming>
      <bpmn:outgoing>Flow_R4</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:endEvent id="EndEvent_RestockComplete" name="Restock Complete / Reabastecimiento Completo">
      <bpmn:incoming>Flow_PricesApplied</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:serviceTask id="Activity_ApplyPrices" name="Apply Selling Prices / Aplicar Precios" camunda:type="external" camunda:topic="pricing-apply-prices">
      <bpmn:documentation>UPDATED: This task updates the selling price based on the new weighted average cost.
Trigger Logic: Selling Price = Cost * 1.65</bpmn:documentation>
      <bpmn:incoming>Flow_R4</bpmn:incoming>
      <bpmn:outgoing>Flow_PricesApplied</bpmn:outgoing>
    </bpmn:serviceTask>
  </bpmn:process>
  <bpmn:error id="Error_FinancialFailed" name="Financial Transaction Failed" errorCode="ERR_FINANCIAL_001" />
  <bpmndi:BPMNDiagram id="BPMNDiagram_Restock">
    <bpmndi:BPMNPlane id="BPMNPlane_Restock" bpmnElement="Collaboration_Restock">
      <bpmndi:BPMNShape id="Participant_Restock_di" bpmnElement="Participant_Restock" isHorizontal="true">
        <dc:Bounds x="160" y="80" width="3000" height="520" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Lane_System_di" bpmnElement="Lane_System" isHorizontal="true">
        <dc:Bounds x="190" y="260" width="2970" height="340" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Lane_Admin_di" bpmnElement="Lane_Admin" isHorizontal="true">
        <dc:Bounds x="190" y="80" width="2970" height="180" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="StartEvent_Restock_di" bpmnElement="StartEvent_Restock" bioc:stroke="#43A047" bioc:fill="#C8E6C9">
        <dc:Bounds x="232" y="152" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="210" y="195" width="81" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_EnterRestock_di" bpmnElement="Activity_EnterRestock" bioc:stroke="#1E88E5" bioc:fill="#BBDEFB">
        <dc:Bounds x="320" y="130" width="160" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_QueryDemandStudy_di" bpmnElement="Activity_QueryDemandStudy" bioc:stroke="#FB8C00" bioc:fill="#FFE0B2">
        <dc:Bounds x="530" y="300" width="160" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_ReviewProposals_di" bpmnElement="Activity_ReviewProposals" bioc:stroke="#1E88E5" bioc:fill="#BBDEFB">
        <dc:Bounds x="750" y="130" width="160" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_ApproveReject_di" bpmnElement="Gateway_ApproveReject" isMarkerVisible="true" bioc:stroke="#FDD835" bioc:fill="#FFF9C4">
        <dc:Bounds x="980" y="145" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="983" y="106" width="54" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_RestockRejected_di" bpmnElement="EndEvent_RestockRejected" bioc:stroke="#E53935" bioc:fill="#FFCDD2">
        <dc:Bounds x="987" y="212" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="922" y="210" width="56" height="40" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_RecordFinancial_di" bpmnElement="Activity_RecordFinancial" bioc:stroke="#8E24AA" bioc:fill="#E1BEE7">
        <dc:Bounds x="1100" y="300" width="160" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_RestockAborted_di" bpmnElement="EndEvent_RestockAborted" bioc:stroke="#E53935" bioc:fill="#FFCDD2">
        <dc:Bounds x="1132" y="472" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1117" y="510" width="85" height="40" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_UpdateStock_di" bpmnElement="Activity_UpdateStock" bioc:stroke="#FB8C00" bioc:fill="#FFE0B2">
        <dc:Bounds x="1350" y="300" width="160" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_VerifyConsistency_di" bpmnElement="Activity_VerifyConsistency" bioc:stroke="#FB8C00" bioc:fill="#FFE0B2">
        <dc:Bounds x="1600" y="300" width="160" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_NegativeStock_di" bpmnElement="Gateway_NegativeStock" isMarkerVisible="true" bioc:stroke="#FDD835" bioc:fill="#FFF9C4">
        <dc:Bounds x="1850" y="315" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1839" y="276" width="81" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_ResetNegativeStock_di" bpmnElement="Activity_ResetNegativeStock" bioc:stroke="#E53935" bioc:fill="#FFCDD2">
        <dc:Bounds x="2050" y="480" width="160" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_CalculateWAC_di" bpmnElement="Activity_CalculateWAC" bioc:stroke="#8E24AA" bioc:fill="#E1BEE7">
        <dc:Bounds x="2400" y="400" width="160" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_RestockComplete_di" bpmnElement="EndEvent_RestockComplete" bioc:stroke="#43A047" bioc:fill="#C8E6C9">
        <dc:Bounds x="2800" y="132" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="2845" y="173" width="90" height="53" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_ApplyPrices_di" bpmnElement="Activity_ApplyPrices" bioc:stroke="#757575" bioc:fill="#E0E0E0">
        <dc:Bounds x="2810" y="420" width="160" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BoundaryEvent_FinancialFail_di" bpmnElement="BoundaryEvent_FinancialFail">
        <dc:Bounds x="1132" y="362" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1047" y="386" width="85" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_R1_di" bpmnElement="Flow_R1">
        <di:waypoint x="268" y="170" />
        <di:waypoint x="320" y="170" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_R_Demand_di" bpmnElement="Flow_R_Demand">
        <di:waypoint x="480" y="170" />
        <di:waypoint x="505" y="170" />
        <di:waypoint x="505" y="340" />
        <di:waypoint x="530" y="340" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_ToReview_di" bpmnElement="Flow_ToReview">
        <di:waypoint x="690" y="340" />
        <di:waypoint x="720" y="340" />
        <di:waypoint x="720" y="170" />
        <di:waypoint x="750" y="170" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_R6_di" bpmnElement="Flow_R6">
        <di:waypoint x="910" y="170" />
        <di:waypoint x="980" y="170" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Approved_di" bpmnElement="Flow_Approved">
        <di:waypoint x="1030" y="170" />
        <di:waypoint x="1065" y="170" />
        <di:waypoint x="1065" y="340" />
        <di:waypoint x="1100" y="340" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1056" y="153" width="47" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Rejected_di" bpmnElement="Flow_Rejected">
        <di:waypoint x="1005" y="195" />
        <di:waypoint x="1005" y="212" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1010" y="198" width="44" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Abort_di" bpmnElement="Flow_Abort">
        <di:waypoint x="1150" y="398" />
        <di:waypoint x="1150" y="472" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_FinancialOK_di" bpmnElement="Flow_FinancialOK">
        <di:waypoint x="1260" y="340" />
        <di:waypoint x="1350" y="340" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_StockUpdated_di" bpmnElement="Flow_StockUpdated">
        <di:waypoint x="1510" y="340" />
        <di:waypoint x="1600" y="340" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_R_Check_di" bpmnElement="Flow_R_Check">
        <di:waypoint x="1760" y="340" />
        <di:waypoint x="1850" y="340" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_NegYes_di" bpmnElement="Flow_NegYes">
        <di:waypoint x="1875" y="365" />
        <di:waypoint x="1875" y="520" />
        <di:waypoint x="2050" y="520" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1881" y="443" width="44" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_NegNo_di" bpmnElement="Flow_NegNo">
        <di:waypoint x="1900" y="340" />
        <di:waypoint x="2200" y="340" />
        <di:waypoint x="2200" y="440" />
        <di:waypoint x="2400" y="440" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="2100" y="422" width="39" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_AfterReset_di" bpmnElement="Flow_AfterReset">
        <di:waypoint x="2210" y="520" />
        <di:waypoint x="2250" y="520" />
        <di:waypoint x="2250" y="440" />
        <di:waypoint x="2400" y="440" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_R4_di" bpmnElement="Flow_R4">
        <di:waypoint x="2560" y="440" />
        <di:waypoint x="2685" y="440" />
        <di:waypoint x="2685" y="460" />
        <di:waypoint x="2810" y="460" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_PricesApplied_di" bpmnElement="Flow_PricesApplied">
        <di:waypoint x="2890" y="420" />
        <di:waypoint x="2890" y="295" />
        <di:waypoint x="2818" y="295" />
        <di:waypoint x="2818" y="168" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
